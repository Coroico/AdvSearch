/*
 * advsearch 1.0.0 - package AdvSearch - JQuery 1.7.1
 * author: Coroico - www.modx.wangba.fr - 25/01/2012
 *
 * Licensed under the GPL license: http://www.gnu.org/copyleft/gpl.html
 */

// set the folder location to the correct location of advsearch scripts
var _basejs='assets/components/advsearch/js/';

// set the loading and the close image to the correct location for you
var _close=_basejs + 'images/close2.png';  // close image
var _closeAlt='close search';
var _load=_basejs + 'images/indicator.white.gif'; // loading image
var _loadAlt='loading';

// minimum number of characters. Should be coherent with advSearch snippet call
var _minChars=3;  

jQuery(function($) {

$.fn.reswinUp = function(e) {
	return this.each(function() {
		switch(e){
			case "showfade":
				$(this).fadeOut(800).hide(1200);
				break;
			case "slidefade":
				$(this).fadeOut(800).slideUp(1200);
				break;
			case "basic":
			default:
				$(this).hide();
		}
    });
}

$.fn.reswinDown = function(e) {
	return this.each(function() {
		switch(e){
			case "showfade":
				$(this).show(800).fadeIn(1200);
				break;
			case "slidefade":
				$(this).slideDown(800).fadeIn(1200);
				break;
			case "basic":
			default:
				$(this).show();
		}
    });
}

function pageLink(a,b){var c={asid:a.asid,form:a.fm,sub:a.sb};c[a.sx]=a.st;c[a.ox]=b;$.getJSON(a.arh,c,function(b){if(b){ids="";if(b.ids)ids=b.ids;json="";if(b.json)json=b.json;html="";if(b.html)html=b.html;a.ofs=parseInt(b.ofs);if(a.gmp&&json)gmUpdateMap(a.gmp,json);a.rw.reswinUp(a.eff);a.rw.html(html).reswinDown(a.eff);initPageLinks(a)}})}function initPageLinks(a){if(a){links=a.rw.find(".advsea-page a").not(".advsea-current-page a");links.each(function(){var b=$(this).attr("href");$(this).attr("href","javascript:void(0);");var c=/&offset=([0-9]*)/i;var d=c.exec(b);$(this).click(function(){pageLink(a,d[1])})})}}function prevNext(a,b){var c=a.ofs+b*a.ppg;var d={asid:a.asid,form:a.fm,sub:a.sb};d[a.sx]=a.st;d[a.ox]=c;$.getJSON(a.arh,d,function(b){if(b){ids="";if(b.ids)ids=b.ids;json="";if(b.json)json=b.json;html="";if(b.html)html=b.html;a.ofs=parseInt(b.ofs);if(a.gmp&&json)gmUpdateMap(a.gmp,json);a.rw.reswinUp(a.eff);a.rw.html(html).reswinDown(a.eff);initPrevNext(a)}})}function initPrevNext(a){if(a){next=a.rw.find(".advsea-next a");next.attr("href","javascript:void(0);");next.click(function(){prevNext(a,1)});prev=a.rw.find(".advsea-previous a");prev.attr("href","javascript:void(0);");prev.click(function(){prevNext(a,-1)})}}function closeSearch(a){a.rw.reswinUp(a.eff);a.cl.hide();a.ld.hide();if(a.si.length)a.si.val(a.cdt);a.is=false;if(!a.ls)a.ss.removeAttr("disabled")}function doSearch(a){if(!a.ls&&a.is)return false;st="";if(a.si.length)st=a.si.val();else if(a.se.length){sl=new Array;a.se.find("option:selected").each(function(a){sl.push($(this).attr("value"))});st=sl.join(" ")}if(st==a.cdt)st="";a.st=st;if(a.si.length&&st.length!=0&&a.ls&&st.length<a.mc)return false;a.fm=JSON.stringify($("#"+p+"advsea-form").serializeObject());a.is=true;if(!a.ls)a.ss.attr("disabled","disabled");var b={asid:a.asid,asform:a.fm,sub:a.sb};b[a.sx]=a.st;a.cl.hide();a.ld.show();$.getJSON(a.arh,b,function(b){if(b){ids="";if(b.ids)ids=b.ids;json="";if(b.json)json=b.json;html="";if(b.html)html=b.html;a.ppg=parseInt(b.ppg);a.ofs=parseInt(b.ofs);a.pgt=parseInt(b.pgt);a.nbr=parseInt(b.nbr);a.opc=parseFloat(b.opc);a.eff=b.eff;a.rw.hide();a.rw.html(html).css("opacity",a.opc).reswinDown(a.eff);if(a.gmp&&json)gmUpdateMap(a.gmp,json);if(a.pgt==1)initPrevNext(a);else if(a.pgt==2)initPageLinks(a)}if(!a.ls)a.ss.removeAttr("disabled");a.ld.hide();a.cl.show();a.is=false})}function doLiveSearch(a){if(a.lt){window.clearTimeout(a.lt)}a.lt=setTimeout(function(){doSearch(a)},400)}function activateAsInstance(a){if(!a.arh)return false;if(!a.ls)a.ls=0;if(!a.ii)a.ii="none";if(!a.mc)a.mc=_minChars;if(!a.sx)a.sx="search";if(!a.ox)a.ox="offset";a.lt=null;a.is=false;var b=a.asid+"_";a.px=b;a.si=$("#"+b+"advsea-search");ref=a.si;a.se=$("#"+b+"advsea-select");a.sb="Search";if(!a.ls){a.ss=$("#"+b+"advsea-submit");a.sb=a.ss.attr("value");ref=a.ss}a.cl=$('<img src="'+_close+'" class="close-img" alt="'+_closeAlt+'" id="'+b+'close" />').insertAfter(ref).hide();a.ld=$('<img src="'+_load+'" class="load-img" alt="'+_loadAlt+'" id="'+b+'load" />').insertAfter(ref).hide();a.rw=$("#"+b+"advsea-reswin").hide().removeClass("init");a.cl.click(function(){closeSearch(a);return false});if(!a.ls)a.ss.click(function(){doSearch(a);return false});else a.si.keyup(function(){doLiveSearch(a)});if(a.si.length)a.si.keydown(function(b){var c=b.keyCode||b.which;if(c==13){doSearch(a)}});if(a.ii=="none")return false;doSearch(a)}function activateSearch(){for(ias=0;ias<advsea.length;ias++){var asv=eval("("+advsea[ias]+")");activateAsInstance(asv)}}$.fn.serializeObject=function(){var a={};var b=this.serializeArray();$.each(b,function(){if(a[this.name]!==undefined){if(!a[this.name].push){a[this.name]=[a[this.name]]}a[this.name].push(this.value||"")}else{a[this.name]=this.value||""}});return a};activateSearch();
});