/*
 * advsearch 1.0.0 - package AdvSearch - jQuery 1.10.2
 * author:  Coroico - www.revo.wangba.fr - 15/05/2012
 *          goldsky - goldsky@virtudraft.com - 23/12/2013
 * 
 * Licensed under the GPL license: http://www.gnu.org/copyleft/gpl.html
 */
jQuery(function($){function activateSearch(){for(var ias=0;ias<advsea.length;ias++){var asv=eval("("+advsea[ias]+")");activateAsInstance(asv)}}function activateAsInstance(e){if(!e.arh)return!1;e.ls||(e.ls=0),e.ii||(e.ii="none"),e.mc||(e.mc=_minChars),e.sx||(e.sx="search"),e.pax||(e.pax="page"),e.lt=null,e.is=!1;var a=e.asid+"_";e.px=a,e.si=$("#"+a+"advsea-search");var t=e.si;return e.se=$("#"+a+"advsea-select"),e.sb="Search",e.ls||(e.ss=$("#"+a+"advsea-submit"),e.sb=e.ss.attr("value"),t=e.ss),$(".advsea-close-img").each(function(){$(this).remove()}),e.cl=$(e.aci).addClass("advsea-close-img").insertAfter(t).hide(),$(".advsea-load-img").each(function(){$(this).remove()}),e.ld=$(e.ali).addClass("advsea-load-img").insertAfter(t).hide(),e.rw=$("#"+a+"advsea-reswin").hide().removeClass("init"),e.cl.click(function(){return closeSearch(e),!1}),e.ls?e.si.keyup(function(){doLiveSearch(e)}):e.ss.click(function(){return doSearch(e),!1}),e.si.length&&e.si.keydown(function(a){var t=a.keyCode||a.which;13===t&&(doSearch(e),a.preventDefault())}),"all"!==e.ii?!1:(doSearch(e),void 0)}function setGMapMarkers(e,a){if(gMapMarkers=[],markersArray){for(var t in markersArray)markersArray[t].setMap(null);markersArray.length=0}$.each(a,function(a,t){if(t[e.gmpLt]&&t[e.gmpLn]){var r={position:new google.maps.LatLng(t[e.gmpLt],t[e.gmpLn]),title:t[e.gmpTtl],urlID:t.id};if(gMapMarkers.push(r),gMapHolder){var i=new google.maps.Marker(r);i.setMap(gMapHolder),markersArray.push(i)}}})}function doLiveSearch(e){e.lt&&window.clearTimeout(e.lt),e.lt=window.setTimeout(function(){doSearch(e)},400)}function doSearch(e){var a=e.asid+"_";if(!e.ls&&e.is)return!1;var t="";if(e.si.length)t=e.si.val();else if(e.se.length){var r=new Array;e.se.find("option:selected").each(function(){r.push($(this).attr("value"))}),t=r.join(" ")}if(t===e.cdt&&(t=""),e.st=t,"all"!==e.ii&&t.length<e.mc)return!1;var i=$("#"+a+"advsea-form").serializeObject();e.fm=JSON.stringify(i),e.is=!0,e.ls||e.ss.attr("disabled","disabled");var n={asid:e.asid,asform:e.fm,sub:e.sb};n[e.sx]=e.st;var s=new URI(document.location.href),o=s.query(!0);return n[e.pax]=o[e.pax]&&!blockHistoryEvent?o[e.pax]:"number"==typeof e.pag?e.pag:1,e.cl.hide(),e.ld.show(),e.rw.css("opacity",e.opc/2),$.getJSON(e.arh,n,function(a){if(a){var t="";a.ids&&(t=a.ids);var r="";a.json&&(r=a.json);var i="";if(a.html&&(i=a.html),e.ppg=parseInt(a.ppg),e.pag=parseInt(a.pag),e.pgt=parseInt(a.pgt),e.nbr=parseInt(a.nbr),e.opc=parseFloat(a.opc),e.eff=a.eff,e.cdf=a.cdf,e.rw.hide(),e.rw.html(i).css("opacity",e.opc).reswinDown(e.eff),e.gmp&&r){var s=JSON.parse(r);setGMapMarkers(e,s)}1===e.pgt?initPageType1(e):2===e.pgt?initPageType2(e):3===e.pgt&&initPageType3(e)}e.ls||e.ss.removeAttr("disabled"),e.ld.hide(),e.cl.show(),e.is=!1,setBrowserHistory(e,n,a)})}function closeSearch(e){e.rw.reswinUp(e.eff),e.cl.hide(),e.ld.hide(),e.si.length&&($("#"+e.px+"advsea-form")[0].reset(),e.si.prop("placeholder",e.cdt),History.pushState({},document.title,document.location.origin+document.location.pathname)),e.is=!1,e.ls||e.ss.removeAttr("disabled")}function initPageType1(e){if(e){var a=e.rw.find(".advsea-next a");a.attr("href","javascript:void(0);"),a.click(function(){return prevNext(e,1),!1});var t=e.rw.find(".advsea-previous a");t.attr("href","javascript:void(0);"),t.click(function(){return prevNext(e,-1),!1})}}function initPageType2(e){if(e){var a=e.rw.find(".advsea-page a").not(".advsea-current-page a");a.each(function(){var a=$(this).attr("href");$(this).attr("href","javascript:void(0);");var t=/&page=([0-9]*)/i,r=t.exec(a);$(this).click(function(){return pageLink(e,r[1]),!1})})}}function initPageType3(e){if(e){var a=e.rw.find(".advsea-page a").not(".advsea-current-page a");a.each(function(){var a=$(this).attr("href");$(this).attr("href","javascript:void(0);");var t=/&page=([0-9]*)/i,r=t.exec(a);$(this).click(function(){return pageLink(e,r[1]),!1})});var t=e.rw.find(".advsea-next a");t.attr("href","javascript:void(0);"),t.click(function(){return prevNext(e,1),!1});var r=e.rw.find(".advsea-previous a");r.attr("href","javascript:void(0);"),r.click(function(){return prevNext(e,-1),!1})}}function prevNext(e,a){e.pag=e.pag-0+a,blockHistoryEvent=!0,doSearch(e)}function pageLink(e,a){e.pag=a-0,blockHistoryEvent=!0,doSearch(e)}function setBrowserHistory(e,a,t){if(History&&History.enabled&&"all"===e.ii){var r=buildUrl(e,t);r!==document.location.href&&(History.pushState(a,document.title,r),blockHistoryEvent=!0)}}function buildUrl(e,a){var t=new Array,r=JSON.parse(e.fm),i=new URI(document.location.href),n=i.query(!0),s=$.extend({},n,r,{sub:e.sb},{page:a.pag});$.each(s,function(e,a){$.merge(t,[e+"="+a])});var o="?"+t.join("&");return document.location.origin+document.location.pathname+o}var _minChars=3,blockHistoryEvent=!1,gMapMarkers=[],markersArray=[],gMapHolder;$.fn.advSearchGMap=function(e,a){var t=this,r=null,i=this,n=$.extend({zoom:5,centerLat:0,centerLon:0}),s=$.extend({},s,n,a);return i.initialize=function(){function a(e){e===!0?alert("Geolocation service failed."):alert("Your browser doesn't support geolocation."),r.setCenter(c)}var i={zoom:s.zoom};if(r=new google.maps.Map(t.get(0),i),gMapMarkers&&0!==gMapMarkers.length){var n=new google.maps.LatLngBounds,o=JSON.parse(e);$.each(gMapMarkers,function(e,a){var t={position:a.position,map:r,title:a.title,urlID:a.urlID},i=new google.maps.Marker(t);google.maps.event.addListener(i,"click",function(){$.ajax({url:o.gmpWin,cache:!1,data:{urlID:a.urlID},dataType:"html",success:function(e){var a=new google.maps.InfoWindow({content:e});a.open(r,i)}})}),markersArray.push(i),n.extend(a.position)}),r.fitBounds(n)}else if(0===s.centerLat&&0===s.centerLon){var c=new google.maps.LatLng(0,0),l=new Boolean;navigator.geolocation?(l=!0,navigator.geolocation.getCurrentPosition(function(e){c=new google.maps.LatLng(e.coords.latitude,e.coords.longitude),r.setCenter(c)},function(){a(l)})):(l=!1,a(l))}else r.setCenter(new google.maps.LatLng(s.centerLat,s.centerLon));return gMapHolder=r,r},i.getMarkers=function(){return markersArray},i.getOptions=function(){return this.settings},i.setOptions=function(e){this.settings=$.extend({},this.settings,e)},i},$.fn.advSearchInit=function(e){return activateAsInstance(e),this},$.fn.reswinUp=function(e){return this.each(function(){switch(e){case"showfade":$(this).fadeOut(800).hide(1200);break;case"slidefade":$(this).fadeOut(800).slideUp(1200);break;case"basic":default:$(this).hide()}})},$.fn.reswinDown=function(e){return this.each(function(){switch(e){case"showfade":$(this).show(800).fadeIn(1200);break;case"slidefade":$(this).slideDown(800).fadeIn(1200);break;case"basic":default:$(this).show()}})},$.fn.serializeObject=function(){var e={},a=this.serializeArray();return $.each(a,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e};var History=window.History;History&&History.enabled&&History.Adapter.bind(window,"statechange",function(){blockHistoryEvent?blockHistoryEvent=!1:activateSearch()}),activateSearch()});